{% extends "base.html" %}

{% block title %}My Wallet - Smart Toll System{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row mb-4">
        <div class="col-md-12">
            <h2>Wallet Management</h2>
        </div>
    </div>

    <div class="row">
        <!-- Wallet Balance Card -->
        <div class="col-md-4 mb-4">
            <div class="card shadow border-0">
                <div class="card-body text-center bg-gradient">
                    <p class="text-muted mb-2">Current Balance</p>
                    <h1 class="text-success mb-0">₹{{ "%.2f"|format(wallet.balance) }}</h1>
                </div>
                <div class="card-footer bg-light text-center">
                    <small class="text-muted">Last Updated: {{ wallet.last_updated.strftime('%d %b %Y, %H:%M') }}</small>
                </div>
            </div>
        </div>

        <!-- Recharge Card -->
        <div class="col-md-8 mb-4">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Recharge Wallet</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('dashboard.recharge_wallet') }}">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="amount" class="form-label">Recharge Amount (₹)</label>
                                    <input type="number" class="form-control form-control-lg" id="amount" name="amount" 
                                           placeholder="Enter amount" min="100" max="100000" step="100" required>
                                    <small class="form-text text-muted">Minimum: ₹100 | Maximum: ₹100,000</small>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">&nbsp;</label>
                                    <button type="submit" class="btn btn-success btn-lg w-100">
                                        <i class="fas fa-plus-circle"></i> Recharge
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>

                    <!-- Quick Recharge Buttons -->
                    <div class="mt-3">
                        <p class="text-muted mb-2">Quick Recharge:</p>
                        <form method="POST" action="{{ url_for('dashboard.recharge_wallet') }}" class="d-inline">
                            <input type="hidden" name="amount" value="500">
                            <button type="submit" class="btn btn-outline-success btn-sm me-2">₹500</button>
                        </form>
                        <form method="POST" action="{{ url_for('dashboard.recharge_wallet') }}" class="d-inline">
                            <input type="hidden" name="amount" value="1000">
                            <button type="submit" class="btn btn-outline-success btn-sm me-2">₹1000</button>
                        </form>
                        <form method="POST" action="{{ url_for('dashboard.recharge_wallet') }}" class="d-inline">
                            <input type="hidden" name="amount" value="2000">
                            <button type="submit" class="btn btn-outline-success btn-sm me-2">₹2000</button>
                        </form>
                        <form method="POST" action="{{ url_for('dashboard.recharge_wallet') }}" class="d-inline">
                            <input type="hidden" name="amount" value="5000">
                            <button type="submit" class="btn btn-outline-success btn-sm">₹5000</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction History -->
    <div class="row mt-4">
        <div class="col-md-12">
            <div class="card shadow">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Transaction History</h5>
                </div>
                <div class="table-responsive">
                    {% if wallet_transactions %}
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Date & Time</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Reference</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for txn in wallet_transactions %}
                            <tr>
                                <td><small>{{ txn.timestamp.strftime('%d %b %Y, %H:%M') }}</small></td>
                                <td>
                                    {% if txn.txn_type == 'debit' %}
                                        <span class="badge bg-danger">Debit</span>
                                    {% else %}
                                        <span class="badge bg-success">Credit</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if txn.txn_type == 'debit' %}
                                        <span class="text-danger">-₹{{ "%.2f"|format(txn.amount) }}</span>
                                    {% else %}
                                        <span class="text-success">+₹{{ "%.2f"|format(txn.amount) }}</span>
                                    {% endif %}
                                </td>
                                <td><small>{{ txn.reference_txn_id or 'N/A' }}</small></td>
                                <td><strong>₹{{ "%.2f"|format(wallet.balance) }}</strong></td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <div class="alert alert-warning m-3 mb-0" role="alert">
                        <i class="fas fa-info-circle"></i> No transactions yet.
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
